import{getStroke as e}from"./node_modules/.pnpm/perfect-freehand@1.2.0/node_modules/perfect-freehand/dist/esm/index.js";import{getSvgPathFromStroke as t,debounce as s}from"./utils.js";import n from"./line.js";import{pushScopeId as i,popScopeId as a,openBlock as o,createBlock as r,createVNode as l,renderSlot as c,withScopeId as h,createTextVNode as d}from"vue";import"./perfect-signature.vue_vue_type_style_index_0_scoped_true_lang.js";const p={name:"PerfectSignature",computed:{options:()=>({size:32,thinning:.5,smoothing:.5,streamline:.5,easing:e=>e,start:{taper:0,easing:e=>e,cap:!0},end:{taper:100,easing:e=>e,cap:!0}}),pathData(){const s=e(points,this.options);return t(s)}},methods:{handlePointStarts(e){const t=e.targetTouches[0];let s=t.clientX-this.cvsRect.left,n=t.clientY-this.cvsRect.top;[-90,90].includes(window.orientation)||(s=t.clientY-this.cvsRect.top,n=this.cvsRect.right-t.clientX);const i={points:[{time:(new Date).getTime(),x:s,y:n,dis:0}]};this.line.pushLine(i),this.drawerLine()},drawerLine(){const s=e(this.line.getLatestPoints),n=t(s);if(this.line.getLatestPoints.length>2){const e=new Path2D(n);this.canvasCtx.fill(e)}},handlePointMoves(e){const t=e.targetTouches[0];let s=t.clientX-this.cvsRect.left,n=t.clientY-this.cvsRect.top;[-90,90].includes(window.orientation)||(s=t.clientY-this.cvsRect.top,n=this.cvsRect.right-t.clientX),this.line.lastPoint=this.line.currentPoint,this.line.pushLatestPoint({time:(new Date).getTime(),x:s,y:n}),this.drawerLine()},handlePointEnd(){this.canvasCtx.closePath()},handleClear(){const e=this.$refs.canvasRef;this.canvasCtx.clearRect(0,0,e.width,e.height)},handleSave(){const e=this.$refs.canvasRef.toDataURL("image/png");this.$emit("save",{base64:e})},initCtx(){this.handleCvsRsize();const e=this.$refs.canvasRef;this.canvasCtx=e.getContext("2d")},handleBack(){this.$emit("close",!0)},handlePointerDown(e){e.target.setPointerCapture(e.pointerId),setPoints([[e.pageX,e.pageY,e.pressure]]);const t={points:[{time:(new Date).getTime(),x:e.pageX,y:e.pageY,pressure:e.pressure,dis:0}]};this.line.pushLine(t),this.drawerLine()},handlePointerMove(e){this.line.lastPoint=this.line.currentPoint,this.line.pushLatestPoint({time:(new Date).getTime(),x:e.pageX,y:e.pageY,pressure:e.pressure}),this.drawerLine()}},created(){this.line=new n,this.handleCvsRsize=s((()=>{if(!this.$refs)return;const e=this.$refs.signatureBox,{innerWidth:t,innerHeight:s}=window;let n=`height:${t}px;width:${s}px;`;[-90,90].includes(window.orientation)?n=`height:${s}px;width:${t}px;`:n+=`transform:rotate(90deg) translateX(-${t}px);`,e.style=n;const i=this.$refs.canvasRef,{height:a,width:o}=this.$refs.topBar.getBoundingClientRect(),{height:r,width:l}=this.$refs.bottomBar.getBoundingClientRect();[-90,90].includes(window.orientation)?(i.width=t,i.height=s-a-r):(i.height=t-o-l,i.width=s);const c=this.$refs.canvasWrapperRef;this.cvsRect=c.getBoundingClientRect()}))},mounted(){console.log("signa mounted!"),document.body.classList.add("of-hidden"),this.initCtx(),window.addEventListener("resize",this.handleCvsRsize)},unmounted(){document.body.classList.remove("of-hidden"),window.removeEventListener("resize",this.handleCvsRsize)}},v=h("data-v-bba19524");i("data-v-bba19524");const u={class:"signature-box",ref:"signatureBox"},g={class:"top-bar",ref:"topBar"},f=l("span",{class:"icon"},null,-1),m=l("div",{class:"title"},"添加手写签名",-1),w=l("div",null,null,-1),R={class:"canvas-wrapper",ref:"canvasWrapperRef"},P={class:"bottom-bar",ref:"bottomBar"},x={class:"bar-left"},C=l("div",{class:"gap-line"},null,-1),b=l("i",null,null,-1),$=d("保存签名");a();const L=v(((e,t,s,n,i,a)=>(o(),r("div",u,[l("div",g,[c(e.$slots,"topBar",{},(()=>[l("div",{class:"back",onClick:t[1]||(t[1]=(...e)=>a.handleBack&&a.handleBack(...e))},[f]),m,w]))],512),l("div",R,[l("canvas",{class:"canvas","disable-scroll":"true",ref:"canvasRef",onTouchstart:t[2]||(t[2]=(...e)=>a.handlePointStarts&&a.handlePointStarts(...e)),onTouchmove:t[3]||(t[3]=(...e)=>a.handlePointMoves&&a.handlePointMoves(...e)),onTouchend:t[4]||(t[4]=(...e)=>a.handlePointEnd&&a.handlePointEnd(...e))},null,544)],512),l("div",P,[l("div",x,[l("div",{class:"cancel-btn",onClick:t[5]||(t[5]=(...e)=>a.handleClear&&a.handleClear(...e))}),C,l("div",{class:"back",onClick:t[6]||(t[6]=(...e)=>a.handleBack&&a.handleBack(...e))})]),l("div",{class:"save-btn",onClick:t[7]||(t[7]=(...e)=>a.handleSave&&a.handleSave(...e))},[b,$])],512)],512))));p.render=L,p.__scopeId="data-v-bba19524";export{p as default};
